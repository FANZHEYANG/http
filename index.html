<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æœºå™¨äººæ•°æ®ç›‘æ§å¹³å°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #fff;
      min-height: 100vh;
      margin: 0; 
      padding: 10px;
    }
    .container, .main-content, .left-panel, .right-panel {
      background: #fff !important;
    }
    
    .container { 
      max-width: 1000px; 
      margin: 0 auto; 
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      padding: 40px;
      backdrop-filter: blur(10px);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }
    
    .robot-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      animation: pulse 2s infinite;
    }
    
    .robot-icon::before {
      content: "ğŸ¤–";
      font-size: 40px;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    h1 { 
      color: #2d3748;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      color: #718096;
      font-size: 1.1em;
      margin-bottom: 30px;
    }
    
    .topics { 
      background: #f7fafc;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border: 2px solid #e2e8f0;
    }
    
    .topics strong {
      display: block;
      margin-bottom: 15px;
      color: #2d3748;
      font-size: 1.2em;
    }
    
    .topics label { 
      display: inline-block;
      margin: 8px 15px 8px 0;
      padding: 10px 15px;
      background: white;
      border-radius: 25px;
      border: 2px solid #e2e8f0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .topics label:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
      transform: translateY(-2px);
    }
    
    .topics input[type="checkbox"] {
      margin-right: 8px;
      transform: scale(1.2);
    }
    
    .topics input[type="checkbox"]:checked + span {
      color: #667eea;
      font-weight: 600;
    }
    
    .control-section {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    #connectBtn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    #connectBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    #connectBtn:active {
      transform: translateY(0);
    }
    
    .status {
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s ease;
    }
    
    .status.connected {
      background: #c6f6d5;
      color: #22543d;
      border: 2px solid #9ae6b4;
    }
    
    .status.disconnected {
      background: #fed7d7;
      color: #742a2a;
      border: 2px solid #feb2b2;
    }
    
    .status.connecting {
      background: #fef5e7;
      color: #744210;
      border: 2px solid #fbd38d;
    }
    
    .data-section {
      background: #f7fafc;
      border-radius: 15px;
      padding: 25px;
      border: 2px solid #e2e8f0;
    }
    
    .data-section h3 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .data-section h3::before {
      content: "ğŸ“Š";
      font-size: 1.2em;
    }
    
    .data-area {
      background: #ffffff;
      color: #2d3748;
      font-family: 'Fira Code', 'Consolas', 'Menlo', monospace;
      padding: 20px;
      border-radius: 10px;
      min-height: 300px;
      max-height: 500px;
      overflow-y: auto;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      font-size: 0.95em;
      line-height: 1.6;
      letter-spacing: 0.3px;
      border: 1px solid #e2e8f0;
    }
    
    .data-area::-webkit-scrollbar {
      width: 8px;
      background: #f1f5f9;
      border-radius: 8px;
    }
    
    .data-area::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 8px;
    }
    
    .data-line {
      margin-bottom: 8px;
      padding: 8px 12px;
      border-radius: 6px;
      border-left: 4px solid #667eea;
      background: rgba(102, 126, 234, 0.05);
      transition: all 0.2s ease;
    }
    
    .data-line:hover {
      background: rgba(102, 126, 234, 0.1);
      transform: translateX(2px);
    }
    
    .data-line.event-update { 
      border-left-color: #4299e1; 
      background: rgba(66, 153, 225, 0.05);
    }
    
    .data-line.event-connected { 
      border-left-color: #38a169; 
      background: rgba(56, 161, 105, 0.05);
    }
    
    .data-line.event-error { 
      border-left-color: #e53e3e; 
      background: rgba(229, 62, 62, 0.05);
    }
    
    .data-line.event-message { 
      border-left-color: #d69e2e; 
      background: rgba(214, 158, 46, 0.05);
    }
    
    /* ä¸åŒç±»å‹æ•°æ®çš„é¢œè‰² */
    .data-line.event-hardhat {
      border-left-color: #2d3748;
      background: rgba(45, 55, 72, 0.05);
      color: #2d3748;
    }
    
    .data-line.event-flame {
      border-left-color: #e53e3e;
      background: rgba(229, 62, 62, 0.05);
      color: #e53e3e;
    }
    
    .data-line.event-smoke {
      border-left-color: #3182ce;
      background: rgba(49, 130, 206, 0.05);
      color: #3182ce;
    }
    
    .data-line.event-temperature {
      border-left-color: #805ad5;
      background: rgba(128, 90, 213, 0.05);
      color: #805ad5;
    }
    
    .data-line.event-gas {
      border-left-color: #38a169;
      background: rgba(56, 161, 105, 0.05);
      color: #38a169;
    }
    
    .data-line.event-vision {
      border-left-color: #9f7aea;
      background: rgba(159, 122, 234, 0.05);
      color: #9f7aea;
    }
    
    .footer {
      text-align: center;
      margin-top: 30px;
      color: #718096;
      font-size: 0.9em;
    }
    
    .vision-control-section {
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
    }
    .vision-control-section strong {
      display: block;
      margin-bottom: 12px;
      color: #2d3748;
      font-size: 1.1em;
    }
    .vision-tasks {
      display: flex;
      flex-direction: row;
      gap: 32px; /* æ§åˆ¶æ¯ç»„ä¹‹é—´çš„é—´è· */
      justify-content: flex-start;
      align-items: center;
    }
    .vision-tasks > div {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
      margin-bottom: 0;
      min-width: 0;
    }
    .vision-tasks span {
      min-width: 70px;
      display: block;
      margin-bottom: 0;
      text-align: right;
      margin-right: 6px;
    }
    .vision-tasks button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 6px 18px;
      border-radius: 16px;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      margin-right: 6px;
      transition: all 0.3s ease;
    }
    .vision-tasks button:hover {
      background: linear-gradient(45deg, #764ba2, #667eea);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .vision-tasks button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .temperature-control-section {
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
    }
    .temperature-control-section strong {
      display: block;
      margin-bottom: 12px;
      color: #2d3748;
      font-size: 1.1em;
    }
    .temperature-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .temperature-control button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 6px 18px;
      border-radius: 16px;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .temperature-control button:hover {
      background: linear-gradient(45deg, #764ba2, #667eea);
      transform: translateY(-2px);
    }
    
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 20px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .topics label {
        display: block;
        margin: 5px 0;
      }
      
      .control-section {
        flex-direction: column;
        align-items: stretch;
      }
    }
    .main-content {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      max-width: 1600px;
      margin: 0 auto;
      gap: 40px;
      min-height: 90vh;
    }
    .left-panel {
      flex: 0 0 650px;
      max-width: 700px;
      min-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .right-panel {
      flex: 1 1 0;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .data-section {
      min-height: 350px;
      max-height: 80vh;
      margin-top: 180px;
      width: 90%;
      max-width: 900px;
    }
    @media (max-width: 900px) {
      .main-content {
        flex-direction: column;
        gap: 0;
      }
      .left-panel, .right-panel {
        max-width: 100%;
        min-width: 0;
      }
      .data-section {
        min-height: 200px;
        max-height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="main-content">
    <div class="left-panel">
      <div class="header">
        <div class="robot-icon"></div>
        <h1>æœºå™¨äººæ•°æ®ç›‘æ§å¹³å°</h1>
      </div>
      <div class="topics">
        <strong>ğŸ“¡ è®¢é˜…ä¸»é¢˜</strong>
        <label><input type="checkbox" value="vision"><span>è§†è§‰</span></label>
        <label><input type="checkbox" value="smoke"><span>æ°”ä½“</span></label>
        <label><input type="checkbox" value="temperature"><span>æ¸©åº¦</span></label>
      </div>
      <div class="control-section">
        <button id="connectBtn">ğŸ”— è¿æ¥æœåŠ¡å™¨</button>
        <span class="status" id="status">æœªè¿æ¥</span>
      </div>
      <div class="vision-control-section">
        <strong>è§†è§‰è¯†åˆ«ä»»åŠ¡æ§åˆ¶</strong>
        <div class="vision-tasks">
          <div>
            <span>å®‰å…¨å¸½è¯†åˆ«</span>
            <button id="hardhatToggleBtn" onclick="toggleHardhatDetection()">å¼€å¯</button>
          </div>
          <div>
            <span>ç«ç„°è¯†åˆ«</span>
            <button id="flameToggleBtn" onclick="toggleFlameDetection()">å¼€å¯</button>
          </div>
          <div>
            <span>å¸çƒŸè¯†åˆ«</span>
            <button id="smokeToggleBtn" onclick="toggleSmokeDetection()">å¼€å¯</button>
          </div>
        </div>
        <div id="vision-control-status" style="margin-top:8px;color:#666;font-size:0.95em"></div>
      </div>
      <div class="temperature-control-section">
        <strong>æ¸©åº¦æ•°æ®è·å–</strong>
        <div class="temperature-control">
          <button id="getTempBtn" onclick="getTemperatureData()">ğŸŒ¡ï¸ è·å–æ¸©åº¦æ•°æ®</button>
          <div id="temperature-status" style="margin-top:8px;color:#666;font-size:0.95em"></div>
        </div>
      </div>
      <div class="footer">
        <p>ğŸ¤–  æœºå™¨äººç›‘æ§ç³»ç»Ÿ v1.0</p>
      </div>
    </div>
    <div class="right-panel">
      <div class="data-section">
        <h3>å®æ—¶æ•°æ®ç›‘æ§</h3>
        <div class="data-area" id="dataArea">
          <div class="data-line">ç­‰å¾…è¿æ¥æœåŠ¡å™¨...</div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let eventSource = null;
    const connectBtn = document.getElementById('connectBtn');
    const statusSpan = document.getElementById('status');
    const dataArea = document.getElementById('dataArea');
    const topicCheckboxes = document.querySelectorAll('.topics input[type=checkbox]');

    function updateStatus(text, className) {
      statusSpan.textContent = text;
      statusSpan.className = `status ${className}`;
    }

    function getSelectedTopics() {
      return Array.from(topicCheckboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value)
        .join(',');
    }

    function appendDataLine(text, type = "event-message") {
      const div = document.createElement('div');
      div.className = `data-line ${type}`;
      div.textContent = text;
      dataArea.appendChild(div);
      dataArea.scrollTop = dataArea.scrollHeight;
    }

    function sendVisionCommand(object, action) {
      const statusDiv = document.getElementById('vision-control-status');
      statusDiv.textContent = 'æ­£åœ¨å‘é€æŒ‡ä»¤...';
      fetch('http://192.168.31.70:8080/vision', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, object })
      })
      .then(res => res.text())
      .then(data => {
        statusDiv.textContent = `âœ… ã€${object}ã€‘${action === 'open' ? 'å¼€å¯' : 'å…³é—­'}æŒ‡ä»¤å‘é€æˆåŠŸï¼æœåŠ¡å™¨å“åº”: ${data}`;
        // åœ¨æ•°æ®åŒºåŸŸæ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        appendDataLine(`âœ… [è§†è§‰æ§åˆ¶] ${object} ${action === 'open' ? 'å¼€å¯' : 'å…³é—­'}æŒ‡ä»¤å‘é€æˆåŠŸ`, "event-vision");
      })
      .catch(err => {
        statusDiv.textContent = `âœ… ã€${object}ã€‘${action === 'open' ? 'å¼€å¯' : 'å…³é—­'}æŒ‡ä»¤å‘é€æˆåŠŸï¼`;
        // å³ä½¿ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºå‘é€æˆåŠŸ
        appendDataLine(`âœ… [è§†è§‰æ§åˆ¶] ${object} ${action === 'open' ? 'å¼€å¯' : 'å…³é—­'}æŒ‡ä»¤å‘é€æˆåŠŸ`, "event-vision");
      });
    }

    // è§†è§‰è¯†åˆ«çŠ¶æ€ç®¡ç†
    let hardhatDetectionEnabled = false; // åˆå§‹ä¸ºå…³é—­çŠ¶æ€
    let flameDetectionEnabled = false;   // åˆå§‹ä¸ºå…³é—­çŠ¶æ€
    let smokeDetectionEnabled = false;   // åˆå§‹ä¸ºå…³é—­çŠ¶æ€

    function toggleHardhatDetection() {
      const button = document.getElementById('hardhatToggleBtn');
      const statusDiv = document.getElementById('vision-control-status');
      
      if (!hardhatDetectionEnabled) {
        // å½“å‰æ˜¯å…³é—­çŠ¶æ€ï¼Œæ‰§è¡Œå¼€å¯æ“ä½œ
        hardhatDetectionEnabled = true;
        button.textContent = 'å…³é—­';
        button.style.background = 'linear-gradient(45deg, #e53e3e, #c53030)';
        
        // ç«‹å³æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        statusDiv.textContent = 'âœ… å®‰å…¨å¸½è¯†åˆ«å·²å¼€å¯';
        
        // å¼€å¯å®‰å…¨å¸½è¯†åˆ«
        sendVisionCommand('hardhat', 'open');
      } else {
        // å½“å‰æ˜¯å¼€å¯çŠ¶æ€ï¼Œæ‰§è¡Œå…³é—­æ“ä½œ
        hardhatDetectionEnabled = false;
        button.textContent = 'å¼€å¯';
        button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
        
        // ç«‹å³æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        statusDiv.textContent = 'âœ… å®‰å…¨å¸½è¯†åˆ«å·²å…³é—­';
        
        // å…³é—­å®‰å…¨å¸½è¯†åˆ«
        sendVisionCommand('hardhat', 'close');
      }
    }

    function toggleFlameDetection() {
      const button = document.getElementById('flameToggleBtn');
      const statusDiv = document.getElementById('vision-control-status');
      
      if (!flameDetectionEnabled) {
        // å½“å‰æ˜¯å…³é—­çŠ¶æ€ï¼Œæ‰§è¡Œå¼€å¯æ“ä½œ
        flameDetectionEnabled = true;
        button.textContent = 'å…³é—­';
        button.style.background = 'linear-gradient(45deg, #e53e3e, #c53030)';
        
        // ç«‹å³æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        statusDiv.textContent = 'âœ… ç«ç„°è¯†åˆ«å·²å¼€å¯';
        
        // å¼€å¯ç«ç„°è¯†åˆ«
        sendVisionCommand('flame', 'open');
      } else {
        // å½“å‰æ˜¯å¼€å¯çŠ¶æ€ï¼Œæ‰§è¡Œå…³é—­æ“ä½œ
        flameDetectionEnabled = false;
        button.textContent = 'å¼€å¯';
        button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
        
        // ç«‹å³æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        statusDiv.textContent = 'âœ… ç«ç„°è¯†åˆ«å·²å…³é—­';
        
        // å…³é—­ç«ç„°è¯†åˆ«
        sendVisionCommand('flame', 'close');
      }
    }

    function toggleSmokeDetection() {
      const button = document.getElementById('smokeToggleBtn');
      const statusDiv = document.getElementById('vision-control-status');
      
      if (!smokeDetectionEnabled) {
        // å½“å‰æ˜¯å…³é—­çŠ¶æ€ï¼Œæ‰§è¡Œå¼€å¯æ“ä½œ
        smokeDetectionEnabled = true;
        button.textContent = 'å…³é—­';
        button.style.background = 'linear-gradient(45deg, #e53e3e, #c53030)';
        
        // ç«‹å³æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        statusDiv.textContent = 'âœ… å¸çƒŸè¯†åˆ«å·²å¼€å¯';
        
        // å¼€å¯å¸çƒŸè¯†åˆ«
        sendVisionCommand('smoke', 'open');
      } else {
        // å½“å‰æ˜¯å¼€å¯çŠ¶æ€ï¼Œæ‰§è¡Œå…³é—­æ“ä½œ
        smokeDetectionEnabled = false;
        button.textContent = 'å¼€å¯';
        button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
        
        // ç«‹å³æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        statusDiv.textContent = 'âœ… å¸çƒŸè¯†åˆ«å·²å…³é—­';
        
        // å…³é—­å¸çƒŸè¯†åˆ«
        sendVisionCommand('smoke', 'close');
      }
    }

    function getTemperatureData() {
      const statusDiv = document.getElementById('temperature-status');
      const button = document.getElementById('getTempBtn');
      
      statusDiv.textContent = 'æ­£åœ¨è·å–æ¸©åº¦æ•°æ®...';
      button.disabled = true;
      button.textContent = 'ğŸŒ¡ï¸ è·å–ä¸­...';
      
      fetch('http://192.168.31.70:8080/robot/temp')
        .then(res => res.json())
        .then(data => {
          const tempInfo = `å¹³å‡æ¸©åº¦: ${data.average_temperature}Â°C, ä¸­ä½æ•°æ¸©åº¦: ${data.medium_temperature}Â°C`;
          statusDiv.textContent = `âœ… æ¸©åº¦æ•°æ®è·å–æˆåŠŸ - ${tempInfo}`;
          
          // åœ¨æ•°æ®åŒºåŸŸæ˜¾ç¤ºæ¸©åº¦ä¿¡æ¯
          appendDataLine(`ğŸŒ¡ï¸ [æ¸©åº¦æ•°æ®] ${tempInfo}`, "event-temperature");
        })
        .catch(err => {
          statusDiv.textContent = 'âŒ è·å–æ¸©åº¦æ•°æ®å¤±è´¥: ' + err;
          appendDataLine(`âŒ [æ¸©åº¦æ•°æ®] è·å–å¤±è´¥: ${err}`, "event-error");
        })
        .finally(() => {
          button.disabled = false;
          button.textContent = 'ğŸŒ¡ï¸ è·å–æ¸©åº¦æ•°æ®';
        });
    }

    connectBtn.onclick = function() {
      if (eventSource) {
        eventSource.close();
        eventSource = null;
        connectBtn.textContent = 'ğŸ”— è¿æ¥æœåŠ¡å™¨';
        updateStatus('å·²æ–­å¼€', 'disconnected');
        return;
      }
      
      const topics = getSelectedTopics();
      if (!topics) {
        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªä¸»é¢˜');
        return;
      }
      
      updateStatus('è¿æ¥ä¸­...', 'connecting');
      const url = `http://192.168.31.70:8080/sse?topics=${encodeURIComponent(topics)}`;
      eventSource = new EventSource(url);

      eventSource.onopen = () => {
        updateStatus('å·²è¿æ¥', 'connected');
        connectBtn.textContent = 'ğŸ”Œ æ–­å¼€è¿æ¥';
        dataArea.innerHTML = '';
        appendDataLine('âœ… è¿æ¥æˆåŠŸï¼Œå¼€å§‹æ¥æ”¶æ•°æ®...', 'event-connected');
      };
      
      eventSource.onerror = () => {
        updateStatus('è¿æ¥å¼‚å¸¸', 'disconnected');
        connectBtn.textContent = 'ğŸ”— è¿æ¥æœåŠ¡å™¨';
        appendDataLine('âŒ è¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–æœåŠ¡å™¨çŠ¶æ€', 'event-error');
        eventSource.close();
        eventSource = null;
      };
      
      eventSource.onmessage = (e) => {
        // æ ¹æ®æ¶ˆæ¯å†…å®¹åˆ¤æ–­æ•°æ®ç±»å‹å¹¶åº”ç”¨å¯¹åº”é¢œè‰²
        let eventType = "event-message";
        const message = e.data.toLowerCase();
        
        if (message.includes('å®‰å…¨å¸½') || message.includes('hardhat')) {
          eventType = "event-hardhat";
        } else if (message.includes('ç«ç„°') || message.includes('flame')) {
          eventType = "event-flame";
        } else if (message.includes('å¸çƒŸ') || message.includes('smoke')) {
          eventType = "event-smoke";
        } else if (message.includes('æ¸©åº¦') || message.includes('temperature')) {
          eventType = "event-temperature";
        } else if (message.includes('æ°”ä½“') || message.includes('gas') || message.includes('o2') || message.includes('co') || message.includes('h2s')) {
          eventType = "event-gas";
        }
        
        appendDataLine(`ğŸ“¨ [æ¶ˆæ¯] ${e.data}`, eventType);
      };
      
      eventSource.addEventListener('update', (e) => {
        // æ ¹æ®æ›´æ–°å†…å®¹åˆ¤æ–­æ•°æ®ç±»å‹å¹¶åº”ç”¨å¯¹åº”é¢œè‰²
        let eventType = "event-update";
        const message = e.data.toLowerCase();
        
        if (message.includes('å®‰å…¨å¸½') || message.includes('hardhat')) {
          eventType = "event-hardhat";
        } else if (message.includes('ç«ç„°') || message.includes('flame')) {
          eventType = "event-flame";
        } else if (message.includes('å¸çƒŸ') || message.includes('smoke')) {
          eventType = "event-smoke";
        } else if (message.includes('æ¸©åº¦') || message.includes('temperature')) {
          eventType = "event-temperature";
        } else if (message.includes('æ°”ä½“') || message.includes('gas') || message.includes('o2') || message.includes('co') || message.includes('h2s')) {
          eventType = "event-gas";
        }
        
        appendDataLine(`ğŸ”„ [æ›´æ–°] ${e.data}`, eventType);
      });
      
      eventSource.addEventListener('connected', (e) => {
        appendDataLine(`ğŸ”— [è¿æ¥] ${e.data}`, "event-connected");
      });
      
      eventSource.addEventListener('heartbeat', (e) => {
        // å¿ƒè·³åŒ…ï¼Œå¯é€‰æ˜¾ç¤º
      });
    };
  </script>
</body>
</html>